# Mock CRM
> Pictures and clear concise steps are important as well as making it clear why we are doing each step.

## Overview
- What is this NodeJS mocking?
- the customer service rep on prem CRM

## What does it do?
- Talk about customer search, customer details, new customer, new visit

## How to get node app up and running
- node server.js

## Rest API
- Document the rest endpoints
- Show how to use with postman (maybe with screenshots?)
- I think it's important to show customers how to debug

# Docker?
- Put on docker and configure with secure gateway?

# Mock CRM
> Pictures and clear concise steps are important as well as making it clear why we are doing each step.

## Overview
- What is this NodeJS mocking?
- the customer service rep on prem CRM

## What does it do?
- Talk about customer search, customer details, new customer, new visit

## How to get node app up and running
- node server.js

## Rest API
- Document the rest endpoints
- Show how to use with postman (maybe with screenshots?)
- I think it's important to show customers how to debug

# Docker?
- Put on docker and configure with secure gateway?

This page shows the NodeJS End-points for our CRM Backend.

üëç Finished

üëé Not Necessary at the Moment

üìå Need to finish

‚ùì Questions about documentation

## GET - / -  üëç 
- This is the root endpoint that will list all customers in the CRM.
Testing:
```bash
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/ -vv
# Expected: Result
# 200 
# []
```

## GET - /customers üëç 
- List all Customers in the CRM.
Testing:
```bash
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers -vv
# Expected: Result
# 200 
# []
```



## GET - /customers/:id üëç 
- Returns a single customer record.

Testing:
```bash
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1 -vv
# Expected: Result
# 200 
# []
```



## GET - /customers/:customerId/visits/ üëç   
- Returns array of visits corresponding to the customerID.

Testing:
```bash
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/ -vv

# Expected: Result
# 200 
# []
```

## GET - /customers/:customerId/visits/:visitId üëç 
- Returns a single visit

Testing:
```bash
curl -X PUT -H "Content-Type: application/json" -d '{  "date": "2016-06-23",  "type": "oil visit",  "comment": "hello this is a comment"}' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/1" -vv

curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/ -vv

##200
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/1 -vv


## Customer not found:
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/44/visits/1 -vv

## Visit not found:
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/10 -vv

```
## POST - /customers/_search - Input "document" object  (requires update on nodeJS) üëç 
- The JSON Object is a filter to be used to search on the DB for name or plates like `{"name":"Rick"}` or `{"plates":"12345"}`.

> This post does not update the DB, it is a view.

- this call returns a list of subset of information of the object, for now 
{name: "...", plate: "...", id:"..." }; 
* This is similar to a query on cloudant, not a getAll as "/customers".
        
Testing:
```bash
# 200
curl -X POST -H "Content-Type: application/json" -d '{  "plate":"ETS-9876" }' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/_search" -vv

# 200 - array empty - [] if it is not found
curl -X POST -H "Content-Type: application/json" -d '{  "plate":"NONON" }' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/_search" -vv

```
## POST - /customers - Input "document" object üëç 
- This Create/Update a customer based on the document.id ‚ùì  Is this really an update?
- "document"object is a customer record. 

## DELETE - /customers/:id üëç 
- Removes a customer record from CRM.

## PUT - /customers/:id üëç  Input "document" object (requires update on nodeJS)
- Create/Update a customer based on "id" provided on the URL
- "document"object is a customer record
- delta changes are support, and a field by field search must be done.. 
(@cesarlb: I see issues with nested objects - 2016-08-23) <- (@dora how :question:)

**Observation:** 
This Method was refactored to be more simple and cleaner. 

Testing it:
```bash
curl -X PUT -H "Content-Type: application/json" -d '{ "name": "New Name - B" }' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1" -vv
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/ -vv
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1 -vv

curl -X PUT -H "Content-Type: application/json" -d '{ "name": "New Name - A" }' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1" -vv
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1 -vv

```
## POST - /customers/:customerId/visits/ üëç  
- Visit Record:  { id: "..", date: "...",  type: "..."}
Create a new visit record if **no document.id** is provided in the body.  e.g: 
```
{ date: "...",  type: "..."}
```
We do not care if **no document.id**  is provided, so if provided a new record will be created anyway and data will be duplicated. 

this was not implemented yet, it seems PUT suffice what we need for now. (@cesarlb - 2016-08-23)

Testing:
```bash
curl -X POST -H "Content-Type: application/json" -d '{  "date": "2016-06-23",  "type": "oil visit",  "comment": "hello this is a comment"}' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits" -vv

curl -X POST -H "Content-Type: application/json" -d '{ "id":1 , "date": "2016-06-23",  "type": "oil visit",  "comment": "hello this is a comment - new comment"}' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits" -vv

curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/ -vv

curl -X POST -H "Content-Type: application/json" -d '{ "id":1 , "date": "2016-06-23",  "type": "oil visit",  "comment": "hello this is a comment - new comment update again"}' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits" -vv

curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/ -vv



```

## PUT - /customers/:customerId/visits/:visitId üëç 
1- Create and Update customer visit with the provided ID 
Sample payload::
```
{
  "date": "2016-06-23",
  "type": "oil visit",
  "comment": "hello this is a comment"
}
```

Testing:
```
curl -X PUT -H "Content-Type: application/json" -d '{  "date": "2016-06-23",  "type": "oil visit",  "comment": "hello this is a comment"}' "http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/1" -vv

curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/ -vv

curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/1 -vv

## Customer not found:
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/44/visits/1 -vv

## Visit not found:
curl -X GET http://cap-sg-prd-2.integration.ibmcloud.com:15330/customers/1/visits/10 -vv
# Expected: Result
# 200 
# []
```


> Discussion
I believe that the UI for now should not allow to:
- Remove a customer: :gear:  DELETE - /customers/:id üåÄ 


# Running the server locally for testing
```bash
#Clone Repo
git clone git@github.ibm.com:cord-americas/MotoCorpService.git

# install pre-req
cd ./MotoCorpService/onPremSimulator/demo_server/
npm install
#run server
node server.js

#call to test the server
curl -X GET http://localhost:8080/customers/
```


