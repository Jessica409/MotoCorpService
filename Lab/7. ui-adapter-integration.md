# UI - Adapter Integration

:pushpin: maybe add some code snippets on how integrated adapters with ui, like promises,etc

## Overview
Our UI was done using Ionic 1 and is located in the MotoCorpService/MotoCorp directory. This lab describes the flow between the screen -> adapter -> NodeJS endpoint.

## To setup the app

cd into the MotoCorp directory and enter the following commands to add the iOS & Android platform:

`ionic platform add ios`

`ionic platform add android`

## Add the MFP cordova plugin

`cordova plugin add cordova-plugin-mfp`

## Register the app in Bluemix with the command

`mfpdev app register`

## Deploy the adapter

cd into the Adapters/CustomerInfo directory and build and deploy the CustomerInfo adapter.

`mfpdev adapter build`

`mfpdev adapter deploy`

## Run the app in the emulator

cd into the /MotoCorp directory and run the following commands:

`ionic build ios` (or android)

`ionic emulate ios` (or android)

# Structure of the App

For our Ionic app, the interesting parts are located in the /MotoCorp/www/app directory. Each view has a corresponding controller and uses either the Auth or CRM service from the /services directory. The customer controllers use the CRM service which call the endpoints from the CustomerInfo adapter to work with the customer info from the mock Nodejs backend.


| Code Reference     | html             | controller    | service                           | adapter      |
|:-------------------|:-----------------|:--------------|:----------------------------------|:-------------|
| crmService         | no html          | no controller | crm.js                            | CustomerInfo |
| loginView          | login.html  | login.js      | auth.js                          | UserLogin    |
| customerSearchView | search.html      | search.js     | calls crmService| -            |
| newCustomerView    | new-customer.html | new-customer.js   | calls crmService| -            |
| customerDetailView | view-customer.html    | view-customer.js   | calls crmService| -            |
| newVisitView       | new-visit.html    | new-visit.js      | calls crmService| -            |

## Customer Search
## POST - /customers/_search

HTML: search.html

Controller: search.js

### How it works:

When a customer selects a search type, enters a search query, and hits the search button, the payload (json object) is sent to the CustomerInfo adapter.

This can search on name or plates `{"name":"Rick"}` or `{"plates":"12345"}`.

<img src="https://github.ibm.com/cord-americas/MotoCorpService/blob/master/Lab/img/customerSearch.png" width="310.5" height="552" border="2"/>

## Customer Details
## GET - /customers/:id

HTML: view-customer.html

Controller: view-customer.js

### How it works:

When a customer goes to the customer details page, it will pass the customer ID and do a get on the :id endpoint.

## GET - /customers/:customerId/visits

On the customer details page, it will pass the customer ID to get all the correlating visits to that customer.

<img src="https://github.ibm.com/cord-americas/MotoCorpService/blob/master/Lab/img/profile.png" width="310.5" height="552" border="2"/>

## New Customer Visit
## POST - /customers/:customerId/visits/

HTML: new-visit.html

Controller: new-visit.js

### How it works:

When a customer hits the plus button to add a new customer visit, it will hit the /visits endpoint. The properties in the body are date, type, and comment.

```
{
  "date": "2016-06-23",
  "type": "oil visit",
  "comment": "hello this is a comment"
}
```
<img src="https://github.ibm.com/cord-americas/MotoCorpService/blob/master/Lab/img/newVisit.png" width="310.5" height="552" border="2"/>

## New Customer
## POST - /customers

HTML: new-customer.html

Controller: new-customer.js

### How it works:

When a customer hits the plus button to add a new customer, it will post to the /customers endpoint. The properties in the body are name, plate, make, model, and vin. The id will automatically be generated.

```
{
  "name": "Jack Reacher",
  "plate": "ETS-9876",
  "make": "Honda",
  "model": "Accord",
  "vin": "1234567890"
}
```
<img src="https://github.ibm.com/cord-americas/MotoCorpService/blob/master/Lab/img/newCustomer.png" width="310.5" height="552" border="2"/>
